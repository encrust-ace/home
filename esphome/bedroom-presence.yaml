esphome:
  name: bedroom-presence
  friendly_name: "Bedroom Presence"

esp32:
  board: esp32-s3-devkitc-1
  framework:
    type: esp-idf  # Best for S3-Zero hardware peripherals

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  min_auth_mode: WPA2
  reboot_timeout: 
    minutes: 2
  ap:
    ssid: "Bedroom Presence"
    password: "12345678"

# On S3, logger works over native USB automatically
logger:
  level: INFO

api:

ota:
  - platform: esphome

captive_portal:

web_server:
  
debug:

# ========== HARDWARE BUSES ==========

# S3 uses Hardware UART for LD2420 - No bit-banging!
uart:
  id: uart_bus
  tx_pin: GPIO5
  rx_pin: GPIO6
  baud_rate: 115200

ld2420:
  uart_id: uart_bus

# ========== SENSORS ==========

sensor:
  - platform: wifi_signal
    name: "WiFi Signal (dBm)"
    id: wifi_signal_db
    update_interval: 60s
    entity_category: "diagnostic"

  - platform: uptime
    name: "Uptime"
    unit_of_measurement: "s"
    entity_category: "diagnostic"

  - platform: debug
    free:
      name: "Heap Free"
  
  - platform: ld2420
    moving_distance:
      name: "Moving Distance"
      id: moving_dist

text_sensor:
  - platform: wifi_info
    ssid:
      name: "Connected SSID"
      icon: "mdi:wifi"
      entity_category: "diagnostic"
      
  - platform: ld2420
    fw_version:
      name: "LD2420 Firmware"

binary_sensor:
  - platform: ld2420
    has_target:
      name: "Presence"

# ========== CONFIGURATION ==========

select:
  - platform: ld2420
    operating_mode: 
      name: "Working Mode"

number:
  - platform: ld2420
    presence_timeout:
      name: "Presence Timeout"
    min_gate_distance:
      name: "Min Gate"
    max_gate_distance:
      name: "Max Gate"
    gate_select:
      name: "Gate to Config"
    still_threshold:
      name: "Still Threshold Value"
    move_threshold:
      name: "Move Threshold Value"
    gate_move_sensitivity:
      name: "Calibration Move Sensitivity Factor"
    gate_still_sensitivity: 
      name: "Calibration Still Sensitivity Factor"

button:
  - platform: ld2420
    apply_config:
      name: "Apply Config"
    factory_reset:
      name: "Factory Reset"
    revert_config:
      name: "Undo Edits"

  - platform: restart
    name: "Restart"
    entity_category: diagnostic
